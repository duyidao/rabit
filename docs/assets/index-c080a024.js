import{A as H,B as k,C as N,D as w,i as h,y as A,j as B,_ as P,o as y,c as S,a as x,d as f,w as v,g as b,q as j,F as M,b as U,e as T,t as D,f as z}from"./index-5c486a8c.js";import{E as G,a as R}from"./tab-pane-20fb80f7.js";import{E as $,a as q}from"./breadcrumb-item-2eed0803.js";import{G as K}from"./GoodsItem-75c2dc2a.js";import{a as Y,b as J}from"./category-a9005da6.js";import{g as Q}from"./scroll-b522da2f.js";const L=e=>{let t=0,o=e;for(;o;)t+=o.offsetTop,o=o.offsetParent;return t},W=(e,t)=>Math.abs(L(e)-L(t)),u="ElInfiniteScroll",X=50,Z=200,ee=0,te={delay:{type:Number,default:Z},distance:{type:Number,default:ee},disabled:{type:Boolean,default:!1},immediate:{type:Boolean,default:!0}},I=(e,t)=>Object.entries(te).reduce((o,[n,s])=>{var l,r;const{type:d,default:i}=s,c=e.getAttribute(`infinite-scroll-${n}`);let a=(r=(l=t[c])!=null?l:c)!=null?r:i;return a=a==="false"?!1:a,a=d(a),o[n]=Number.isNaN(a)?i:a,o},{}),O=e=>{const{observer:t}=e[u];t&&(t.disconnect(),delete e[u].observer)},oe=(e,t)=>{const{container:o,containerEl:n,instance:s,observer:l,lastScrollTop:r}=e[u],{disabled:d,distance:i}=I(e,s),{clientHeight:c,scrollHeight:a,scrollTop:_}=n,m=_-r;if(e[u].lastScrollTop=_,l||d||m<0)return;let g=!1;if(o===e)g=a-(c+_)<=i;else{const{clientTop:E,scrollHeight:p}=e,V=W(e,n);g=_+c>=V+E+p-i}g&&t.call(s)};function C(e,t){const{containerEl:o,instance:n}=e[u],{disabled:s}=I(e,n);s||o.clientHeight===0||(o.scrollHeight<=o.clientHeight?t.call(n):O(e))}const ne={async mounted(e,t){const{instance:o,value:n}=t;H(n)||k(u,"'v-infinite-scroll' binding value must be a function"),await N();const{delay:s,immediate:l}=I(e,o),r=Q(e,!0),d=r===window?document.documentElement:r,i=w(oe.bind(null,e,n),s);if(r){if(e[u]={instance:o,container:r,containerEl:d,delay:s,cb:n,onScroll:i,lastScrollTop:d.scrollTop},l){const c=new MutationObserver(w(C.bind(null,e,n),X));e[u].observer=c,c.observe(e,{childList:!0,subtree:!0}),C(e,n)}r.addEventListener("scroll",i)}},unmounted(e){const{container:t,onScroll:o}=e[u];t==null||t.removeEventListener("scroll",o),O(e)},async updated(e){if(!e[u])await N();else{const{containerEl:t,cb:o,observer:n}=e[u];t.clientHeight&&n&&C(e,o)}}},F=ne;F.install=e=>{e.directive("InfiniteScroll",F)};const se=F;function ae(){const e=h({}),t=A();console.log(t);const o=async()=>{const n=await Y(t.params.id);e.value=n.result};return B(()=>o()),{subCategoryData:e}}function le(){const e=A(),t=h({categoryId:e.params.id,page:1,pageSize:20,sortField:"publishTime"}),o=h([]),n=h(!1),s=async()=>{const l=await J(t.value);o.value=[...o.value,...l.result.items],t.value.page*t.value.pageSize>=l.result.counts&&(n.value=!0)};return B(()=>s()),{subCategoryObj:t,goodsList:o,disabled:n,getSubCategoryFn:s}}const re={class:"container"},ie={class:"bread-container"},ce={class:"sub-container"},ue=["infinite-scroll-disabled"],de={__name:"index",setup(e){const{subCategoryData:t}=ae(),{subCategoryObj:o,goodsList:n,disabled:s,getSubCategoryFn:l}=le(),r=i=>{o.value.sortField=i,o.value.page=1,n.value=[],l()},d=i=>{o.value.page+=1,l()};return(i,c)=>{const a=q,_=$,m=R,g=G,E=se;return y(),S("div",re,[x("div",ie,[f(_,{separator:">"},{default:v(()=>[f(a,{to:{path:"/"}},{default:v(()=>[T("首页")]),_:1}),f(a,{to:{path:`/category/${b(t).parentId}`}},{default:v(()=>[T(D(b(t).parentName),1)]),_:1},8,["to"]),f(a,null,{default:v(()=>[T(D(b(t).name),1)]),_:1})]),_:1})]),x("div",ce,[f(g,{modelValue:b(o).sortField,"onUpdate:modelValue":c[0]||(c[0]=p=>b(o).sortField=p),onTabChange:r},{default:v(()=>[f(m,{label:"最新商品",name:"publishTime"}),f(m,{label:"最高人气",name:"orderNum"}),f(m,{label:"评论最多",name:"evaluateNum"})]),_:1},8,["modelValue"]),j((y(),S("div",{class:"body","infinite-scroll-disabled":b(s)},[(y(!0),S(M,null,U(b(n),p=>(y(),z(K,{goods:p,key:p.id},null,8,["goods"]))),128))],8,ue)),[[E,d]])])])}}},ve=P(de,[["__scopeId","data-v-822905ab"]]);export{ve as default};
